PROJECT: Modular Web Dashboard (Node.js + Vanilla JS + Bootstrap + ECharts)

I am building a web-based, configurable dashboard application.

The goal is a minimalistic dashboard system with:
- multiple dashboards (tabs)
- widgets arranged in a fixed grid
- strict server-side persistence (single JSON state)
- modular widget architecture (each widget = isolated module)

This is NOT a framework-heavy project.
No React/Vue.
No LocalStorage.
Everything is explicit, predictable and debuggable.

============================================================
CORE FEATURES (CURRENT STATE)
============================================================

- Express backend with JSON persistence
- Single source of truth: dashboards.json
- Multiple dashboards (tabs)
  - create
  - rename
  - delete (with safety fallback for last dashboard)
- Active dashboard persisted
- Edit mode
  - grid overlay visible
  - widgets draggable (no resize)
  - add widget button visible
- Strict persistence
  - move/add only commits AFTER successful PUT
  - rollback on error
- Central toast system for errors / feedback

============================================================
GRID SYSTEM
============================================================

- Custom grid engine (no gridstack / grid.js)
- Fixed cell size
- Drag & snap movement
- Collision detection
- Grid overlay rendered only in edit mode
- Grid change → onChange(items) → PUT full state → commit

============================================================
WIDGET SYSTEM (IMPORTANT)
============================================================

Each widget is a self-contained module:

/public/widgets/<widgetName>/
  └─ widget.js

Each widget exports:
- meta
- mount(el, ctx)
- update(inst, ctx)
- unmount(inst)

Widgets are mounted via a WidgetHost that:
- syncs widgets with grid items
- mounts/unmounts on dashboard switch
- updates on config changes

Widgets do their own:
- fetch logic
- timers
- rendering
- cleanup

============================================================
CURRENT WIDGETS
============================================================

1) value1x1
- Displays a single numeric value
- Configurable:
  - title
  - refresh interval
  - endpoint
  - query param key/value
- Polls endpoint via fetch
- Fully isolated module

2) gauge3x3
- ECharts gauge
- Configurable:
  - title
  - min / max
  - colored ranges (from/to/color)
  - refresh interval
  - endpoint + params
- Fixed size, centered gauge
- Custom tick/label styling

============================================================
ADD WIDGET MODAL
============================================================

- Generic modal driven by widget meta
- Widget types loaded from registry
- Fields generated dynamically from meta.fields
- Supported field kinds:
  - text
  - number
  - select
  - ranges (custom range editor with color picker)
- Required field validation
- No defaults pre-filled (user must decide)

============================================================
STATE MODEL
============================================================

dashboards.json:

{
  version,
  activeId,
  dashboards: [
    {
      id,
      name,
      items: [
        {
          id,
          x, y, w, h,
          type,
          config { ...widget specific }
        }
      ]
    }
  ]
}

Client keeps full state in memory.
PUT always sends full state.
Server overwrites JSON atomically.

============================================================
PROJECT STRUCTURE
============================================================

project-root/
├─ server/
│  └─ server.js                 # Express server + API + persistence
│
├─ data/
│  └─ dashboards.json           # Persisted state
│
├─ public/
│  ├─ index.html                # App shell, header, tabs, modals
│  ├─ style.css                 # Global styles
│
│  ├─ app.js                    # App orchestrator (state + wiring)
│
│  ├─ api/
│  │  └─ dashboardsApi.js       # REST API wrapper
│
│  ├─ state/
│  │  └─ dashboardsState.js     # Pure state helpers
│
│  ├─ grid/
│  │  ├─ grid.js                # Custom grid engine
│  │  └─ grid.css               # Grid + widget layout
│
│  ├─ widgets/
│  │  ├─ registry.js            # Widget registry + metas
│  │  ├─ host.js                # Widget mount/update/unmount manager
│  │  ├─ value1x1/
│  │  │  └─ widget.js
│  │  └─ gauge3x3/
│  │     └─ widget.js
│
│  └─ ui/
│     ├─ tabsView.js            # Dashboard tabs
│     ├─ addWidgetModal.js      # Generic widget creation modal
│     ├─ editTabModal.js        # Rename / delete dashboard
│     └─ toast.js               # Central toast system
│
└─ package.json

============================================================
DESIGN PRINCIPLES
============================================================

- Explicit state transitions
- No magic data flow
- Widgets are isolated and disposable
- Backend is dumb and reliable
- UI logic is modular and boring (on purpose)
- Easy to debug with DevTools

============================================================
TODO LIST (NEXT STEPS)
============================================================

[ ] Delete widgets
    - probably via widget edit modal
    - strict delete (persist first)

[ ] Edit widget modal
    - reuse addWidgetModal rendering
    - allow updating widget config
    - include Delete button

[ ] linechart4x4 widget
    - ECharts line chart
    - range-based endpoint (from/to)
    - widget-local refresh
    - later: dashboard-wide range

[ ] Range buttons in header
    - set dashboard time range (1h, 6h, 24h, 7d)
    - propagate via widget ctx
    - disable widget-local range where applicable

============================================================
END
============================================================
